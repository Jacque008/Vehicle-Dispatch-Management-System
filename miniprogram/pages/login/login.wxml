<!--pages/login/login.wxml-->
<view class="container">
  <view class="login-content">
    <text class="title">Vehicle Dispatch</text>
    <text class="subtitle">Driver App</text>

    <view class="card">
      <!-- Email Input -->
      <view class="form-group">
        <text class="label">Email Address</text>
        <input
          class="input"
          type="text"
          placeholder="your@email.com"
          value="{{email}}"
          bindinput="onEmailInput"
          disabled="{{otpSent}}"
        />
      </view>

      <!-- OTP Input (shown after OTP sent) -->
      <view class="form-group" wx:if="{{otpSent}}">
        <text class="label">Verification Code</text>
        <input
          class="input"
          type="number"
          placeholder="Enter 6-digit code"
          value="{{otpCode}}"
          bindinput="onOtpInput"
          maxlength="6"
        />
      </view>

      <!-- Send OTP Button -->
      <button
        wx:if="{{!otpSent}}"
        class="button-primary {{!isEmailValid ? 'button-disabled' : ''}}"
        bindtap="handleSendOtp"
        disabled="{{!isEmailValid || loading}}"
      >
        {{loading ? 'Sending...' : 'Send Verification Code'}}
      </button>

      <!-- Verify OTP Button -->
      <view wx:if="{{otpSent}}">
        <button
          class="button-primary {{otpCode.length !== 6 ? 'button-disabled' : ''}}"
          bindtap="handleVerifyOtp"
          disabled="{{otpCode.length !== 6 || loading}}"
        >
          {{loading ? 'Verifying...' : 'Verify & Login'}}
        </button>

        <button class="button-secondary" bindtap="handleChangeEmail">
          Change Email
        </button>
      </view>
    </view>
  </view>
</view>
